
#if 1
#define RATEx86_YMAX
#else
#define RATEx86_YMAX ymax = 0.04
#endif

pattern FALSE  { color = 1 0   0 }
pattern TRUE   { color = 0 1   0 }
pattern ALLYES { color = 1 .69 0 }

#define RATE_DEF_CURVE(ver, curve_name, patt2, def) \
  curve pattern def {                               \
   legend = curve_name                              \
   sql = SELECT standardized_name, rate FROM osdi_rate_by_error_name_4_x386 \
         WHERE standardized_name = patt2            \
	       AND version_name = ver               \
	       AND def_compiled = def;              \
  }

#define RATE_DEF_GRP(ver, patt, patt2)         \
 group patt {          		               \
  RATE_DEF_CURVE(ver, "Part of default configuration (358 files)", patt2, TRUE ) \
  RATE_DEF_CURVE(ver, "Part of remaining code (6 422 files)", patt2, FALSE) \
 }

#define RATE_ALL_GRP(ver, patt, patt2)         \
 group patt {          		               \
  curve pattern TRUE {                         \
   legend = "Part of defconfig"  \
   sql = SELECT standardized_name, rate FROM osdi_rate_by_error_name_4_x386 \
         WHERE standardized_name = patt2       \
	       AND version_name = ver          \
	       AND def_compiled = TRUE;        \
  }                                            \
  curve pattern ALLYES {                       \
   legend = "Part of allyesconfig" \
   sql = SELECT standardized_name, rate FROM osdi_rate_by_error_name_4_x386_allyes \
         WHERE standardized_name = patt2       \
	       AND version_name = ver          \
	       AND allyes_compiled = TRUE;     \
  }                                            \
  curve pattern FALSE {                        \
   legend = "Part of remaining code" \
   sql = SELECT standardized_name, rate FROM osdi_rate_by_error_name_4_x386_allyes \
         WHERE standardized_name = patt2       \
	       AND version_name = ver          \
	       AND allyes_compiled = FALSE;    \
  }                                            \
 }

graph gr/rate-4-241-x86.jgr {
 xaxis = groups
 size = 3 1
 legend = "defaults fontsize 6 x 8 y 0.02"
 RATEx86_YMAX

  RATE_DEF_GRP('linux-2.4.1', "Block"    , 'Block'    ) \
  RATE_DEF_GRP('linux-2.4.1', "Null"     , 'Null'     ) \
  RATE_DEF_GRP('linux-2.4.1', "Var"      , 'Var'      ) \
  RATE_DEF_GRP('linux-2.4.1', "Lock"     , 'Lock'     ) \
  RATE_DEF_GRP('linux-2.4.1', "Intr"     , 'Intr'     ) \
  RATE_DEF_GRP('linux-2.4.1', "LockIntr" , 'LockIntr' ) \
  RATE_DEF_GRP('linux-2.4.1', "Free"     , 'Free'     ) \
  RATE_DEF_GRP('linux-2.4.1', "Size"     , 'Size'     )

}

graph gr/rate-4-2633-x86.jgr {
 xaxis = groups
 size = 3 1
 RATEx86_YMAX
 legend = "defaults fontsize 6 x 14 y 0.010

 newcurve marktype none linetype dotted color 0 0 0
 label : Average
 pts
 0   0.00364
 24  0.00364

"

  RATE_ALL_GRP('linux-2.6.33', "Block"    , 'Block'    ) \
  RATE_ALL_GRP('linux-2.6.33', "Null"     , 'Null'     ) \
  RATE_ALL_GRP('linux-2.6.33', "Var"      , 'Var'      ) \
  RATE_ALL_GRP('linux-2.6.33', "Lock"     , 'Lock'     ) \
  RATE_ALL_GRP('linux-2.6.33', "Intr"     , 'Intr'     ) \
  RATE_ALL_GRP('linux-2.6.33', "LockIntr" , 'LockIntr' ) \
  RATE_ALL_GRP('linux-2.6.33', "Free"     , 'Free'     ) \
  RATE_ALL_GRP('linux-2.6.33', "Size"     , 'Size'     )

}
